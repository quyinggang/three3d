import{g as e,b6 as D,s as F,y as G,aE as W,C as M,O as _,au as H,h as Y,aJ as U,G as Z,ad as q,z as N,af as J,ag as $}from"./three.module-8f39f104.js";import{G as K}from"./dat.gui.module-5ea4ba08.js";import{O as Q}from"./OrbitControls-8206acf3.js";import{_ as ee,r as L,o as te,a as ie,b as ae,c as se,d as oe}from"./index-d7540ef8.js";const re=`
  attribute vec3  customColor;
  attribute float customOpacity;
  attribute float customSize;
  attribute float customAngle;
  attribute float customVisible;

  varying vec4 vColor;
  varying float vAngle;
  
  void main() {
    if ( customVisible > 0.5 ) {
      vColor = vec4( customColor, customOpacity );
    } else {
      vColor = vec4(0.0, 0.0, 0.0, 0.0);
    }
    vAngle = customAngle;

    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_PointSize = customSize * ( 300.0 / length( mvPosition.xyz ) );
    gl_Position = projectionMatrix * mvPosition;
  }
`,ne=`
  uniform sampler2D customTexture;

  varying vec4 vColor;
  varying float vAngle;

  void main() {
    float cosValue = cos(vAngle);
    float sinValue = sin(vAngle);
    vec2 coord = gl_PointCoord.xy - vec2(0.5);
    vec2 rotatedUV = vec2(cosValue * coord.x + sinValue * coord.y + 0.5, cosValue * coord.y - sinValue * coord.x + 0.5);
    gl_FragColor = vColor * texture2D(customTexture, rotatedUV);
  }
`;function p(w,t){this.times=w||[],this.values=t||[]}p.prototype.lerp=function(w){let t=0,o=this.times.length;for(;t<o&&w>this.times[t];)t++;if(t==0)return this.values[0];if(t==o)return this.values[o-1];let r=(w-this.times[t-1])/(this.times[t]-this.times[t-1]);return this.values[0]instanceof e?this.values[t-1].clone().lerp(this.values[t],r):this.values[t-1]+r*(this.values[t]-this.values[t-1])};class b{constructor(){this.position=new e,this.velocity=new e,this.acceleration=new e,this.angle=0,this.angleVelocity=0,this.angleAcceleration=0,this.size=16,this.color=new M,this.opacity=1,this.age=0,this.alive=0}update(t){if(this.position.add(this.velocity.clone().multiplyScalar(t)),this.velocity.add(this.acceleration.clone().multiplyScalar(t)),this.angle+=this.angleVelocity*.01745329251*t,this.angleVelocity+=this.angleAcceleration*.01745329251*t,this.age+=t,this.sizeTween.times.length>0&&(this.size=this.sizeTween.lerp(this.age)),this.colorTween.times.length>0){let o=this.colorTween.lerp(this.age);this.color=new M().setHSL(o.x,o.y,o.z)}this.opacityTween.times.length>0&&(this.opacity=this.opacityTween.lerp(this.age))}}const l=Object.freeze({CUBE:1,SPHERE:2}),B=(w,t)=>w+t*(Math.random()-.5),P=(w,t)=>{let o=new e(Math.random()-.5,Math.random()-.5,Math.random()-.5);return new e().addVectors(w,new e().multiplyVectors(t,o))};class le{constructor(){this.positionStyle=l.CUBE,this.positionBase=new e,this.positionSpread=new e,this.positionRadius=0,this.velocityStyle=l.CUBE,this.velocityBase=new e,this.velocitySpread=new e,this.speedBase=0,this.speedSpread=0,this.accelerationBase=new e,this.accelerationSpread=new e,this.angleBase=0,this.angleSpread=0,this.angleVelocityBase=0,this.angleVelocitySpread=0,this.angleAccelerationBase=0,this.angleAccelerationSpread=0,this.sizeBase=0,this.sizeSpread=0,this.sizeTween=new p,this.colorBase=new e(0,1,.5),this.colorSpread=new e(0,0,0),this.colorTween=new p,this.opacityBase=1,this.opacitySpread=0,this.opacityTween=new p,this.blendStyle=D,this.particleArray=[],this.particlesPerSecond=100,this.particleDeathAge=1,this.emitterAge=0,this.emitterAlive=!0,this.emitterDeathAge=60,this.particleCount=this.particlesPerSecond*Math.min(this.particleDeathAge,this.emitterDeathAge),this.customBufferAttributes=Object.freeze({customVisible:{array:[],size:1},customAngle:{array:[],size:1},customSize:{array:[],size:1},customColor:{array:[],size:3},customOpacity:{array:[],size:1}}),this.particleGeometry=new F,this.particleMesh=new G,this.particleTexture=null,this.particleMaterial=null}setValues(t){if(!t)throw new Error("setValues method need parameters");this.sizeTween=new p,this.colorTween=new p,this.opacityTween=new p;for(let o in t)this[o]=t[o];b.prototype.sizeTween=this.sizeTween,b.prototype.colorTween=this.colorTween,b.prototype.opacityTween=this.opacityTween,this.particleArray=[],this.emitterAge=0,this.emitterAlive=!0,this.particleCount=this.particlesPerSecond*Math.min(this.particleDeathAge,this.emitterDeathAge),this.particleMaterial=new W({uniforms:{customTexture:{value:this.particleTexture}},vertexShader:re,fragmentShader:ne,transparent:!0,blending:D,depthTest:!1,depthWrite:!1})}createParticle(){const{positionStyle:t,velocityStyle:o}=this,r=new b;if(t==l.CUBE&&(r.position=P(this.positionBase,this.positionSpread)),t==l.SPHERE){let c=2*Math.random()-1,h=6.2832*Math.random(),m=Math.sqrt(1-c*c),u=new e(m*Math.cos(h),m*Math.sin(h),c);r.position=new e().addVectors(this.positionBase,u.multiplyScalar(this.positionRadius))}if(o==l.CUBE)r.velocity=P(this.velocityBase,this.velocitySpread);else if(o==l.SPHERE){let c=new e().subVectors(r.position,this.positionBase),h=B(this.speedBase,this.speedSpread);r.velocity=c.normalize().multiplyScalar(h)}r.acceleration=P(this.accelerationBase,this.accelerationSpread),r.angle=B(this.angleBase,this.angleSpread),r.angleVelocity=B(this.angleVelocityBase,this.angleVelocitySpread),r.angleAcceleration=B(this.angleAccelerationBase,this.angleAccelerationSpread),r.size=B(this.sizeBase,this.sizeSpread);const n=P(this.colorBase,this.colorSpread);return r.color=new M().setHSL(n.x,n.y,n.z),r.opacity=B(this.opacityBase,this.opacitySpread),r.age=0,r.alive=0,r}initialize(t){const{particleCount:o,particleArray:r,particleGeometry:n,particleMaterial:c,blendStyle:h,customBufferAttributes:m}=this;if(!c||!n||!o)throw new Error("please call setValues before initialize");if(!(t instanceof _))throw new Error("parameter must be Object3D");const u=[],{customVisible:A,customColor:z,customOpacity:E,customSize:f,customAngle:d}=m;for(let a=0;a<o;a++){const i=this.createParticle(),{position:s,color:y,opacity:S,size:v,angle:g,alive:C}=i;u.push(s.x,s.y,s.z),z.array.push(y.r,y.g,y.b),A.array.push(C),E.array.push(S),f.array.push(v),d.array.push(g),r.push(i)}n.setAttribute("position",new H(u,3));for(const[a,i]of Object.entries(m))n.setAttribute(a,new H(i.array,i.size));c.blending=h,h!=D&&(c.depthTest=!1),this.particleMesh=new G(n,c),t.add(this.particleMesh)}update(t){const o=[],{particleArray:r,particleGeometry:n,particleCount:c,particleDeathAge:h}=this,{customVisible:m,customColor:u,customOpacity:A,customSize:z,customAngle:E,position:f}=n.attributes;for(let d=0;d<c;d++){const a=r[d];if(a.alive){a.update(t),a.age>h&&(a.alive=0,o.push(d));const{alive:i,color:s,opacity:y,size:S,angle:v,position:g}=a;f.setXYZ(d,g.x,g.y,g.z),u.setXYZ(d,s.r,s.g,s.b),m.setX(d,i),A.setX(d,y),z.setX(d,S),E.setX(d,v)}}if(n.attributes.position.needsUpdate=!0,n.attributes.customVisible.needsUpdate=!0,n.attributes.customColor.needsUpdate=!0,n.attributes.customOpacity.needsUpdate=!0,n.attributes.customSize.needsUpdate=!0,n.attributes.customAngle.needsUpdate=!0,!!this.emitterAlive){if(this.emitterAge<h){let d=Math.round(this.particlesPerSecond*(this.emitterAge+0)),a=Math.round(this.particlesPerSecond*(this.emitterAge+t));a>this.particleCount&&(a=this.particleCount);for(let i=d;i<a;i++)this.particleArray[i].alive=1}o.forEach(d=>{this.particleArray[d]=this.createParticle(),this.particleArray[d].alive=1;const{x:a,y:i,z:s}=this.particleArray[d].position;f.setXYZ(d,a,i,s)}),o.length>0&&(n.attributes.position.needsUpdate=!0),this.emitterAge+=t,this.emitterAge>this.emitterDeathAge&&(this.emitterAlive=!1)}}destroy(t){t instanceof _&&(this.particleMesh&&t.remove(this.particleMesh),this.particleMesh=null)}}const ce={__name:"ParticleEffect",setup(w){let t=null;const o=L(null),r=L(null);let n=null;const c=new Y;c.setPath("/src/assets/textures/sprites/");const h={starfield:{positionStyle:l.CUBE,positionBase:new e(0,200,0),positionSpread:new e(600,400,600),velocityStyle:l.CUBE,velocityBase:new e(0,0,0),velocitySpread:new e(.5,.5,.5),angleBase:0,angleSpread:720,angleVelocityBase:0,angleVelocitySpread:4,particleTexture:c.load("spikey.png"),sizeBase:10,sizeSpread:2,colorBase:new e(.15,1,.9),colorSpread:new e(0,0,.2),opacityBase:1,particlesPerSecond:2e4,particleDeathAge:60,emitterDeathAge:.1},fireball:{positionStyle:l.SPHERE,positionBase:new e(0,50,0),positionRadius:2,velocityStyle:l.SPHERE,speedBase:40,speedSpread:8,particleTexture:c.load("smokeparticle.png"),sizeTween:new p([0,.1],[1,150]),opacityTween:new p([.7,1],[1,0]),colorBase:new e(.02,1,.4),blendStyle:U,particlesPerSecond:60,particleDeathAge:1.5,emitterDeathAge:60},smoke:{positionStyle:l.CUBE,positionBase:new e(0,0,0),positionSpread:new e(10,0,10),velocityStyle:l.CUBE,velocityBase:new e(0,150,0),velocitySpread:new e(80,50,80),accelerationBase:new e(0,-10,0),particleTexture:c.load("smokeparticle.png"),angleBase:0,angleSpread:720,angleVelocityBase:0,angleVelocitySpread:720,sizeTween:new p([0,1],[32,128]),opacityTween:new p([.8,2],[.5,0]),colorTween:new p([.4,1],[new e(0,0,.2),new e(0,0,.5)]),particlesPerSecond:200,particleDeathAge:2,emitterDeathAge:60},clouds:{positionStyle:l.CUBE,positionBase:new e(-100,100,0),positionSpread:new e(0,50,60),velocityStyle:l.CUBE,velocityBase:new e(40,0,0),velocitySpread:new e(20,0,0),particleTexture:c.load("smokeparticle.png"),sizeBase:80,sizeSpread:100,colorBase:new e(0,0,1),opacityTween:new p([0,1,4,5],[0,1,1,0]),particlesPerSecond:50,particleDeathAge:10,emitterDeathAge:60},snow:{positionStyle:l.CUBE,positionBase:new e(0,200,0),positionSpread:new e(500,0,500),velocityStyle:l.CUBE,velocityBase:new e(0,-60,0),velocitySpread:new e(50,20,50),accelerationBase:new e(0,-10,0),angleBase:0,angleSpread:720,angleVelocityBase:0,angleVelocitySpread:60,particleTexture:c.load("snowflake.png"),sizeTween:new p([0,.25],[1,10]),colorBase:new e(.66,1,.9),opacityTween:new p([2,3],[.8,0]),particlesPerSecond:200,particleDeathAge:4,emitterDeathAge:60},rain:{positionStyle:l.CUBE,positionBase:new e(0,200,0),positionSpread:new e(600,0,600),velocityStyle:l.CUBE,velocityBase:new e(0,-400,0),velocitySpread:new e(10,50,10),accelerationBase:new e(0,-10,0),particleTexture:c.load("raindrop2flip.png"),sizeBase:8,sizeSpread:4,colorBase:new e(.66,1,.7),colorSpread:new e(0,0,.2),opacityBase:.6,particlesPerSecond:1e3,particleDeathAge:1,emitterDeathAge:60},fireflies:{positionStyle:l.CUBE,positionBase:new e(0,100,0),positionSpread:new e(400,200,400),velocityStyle:l.CUBE,velocityBase:new e(0,0,0),velocitySpread:new e(60,20,60),particleTexture:c.load("spark.png"),sizeBase:40,sizeSpread:6,opacityTween:new p([0,1,1.1,2,2.1,3,3.1,4,4.1,5,5.1,6,6.1],[.2,.2,1,1,.2,.2,1,1,.2,.2,1,1,.2]),colorBase:new e(.3,1,.6),colorSpread:new e(.3,0,0),particlesPerSecond:20,particleDeathAge:6.1,emitterDeathAge:600},firework:{positionStyle:l.SPHERE,positionBase:new e(0,100,0),positionRadius:10,velocityStyle:l.SPHERE,speedBase:90,speedSpread:10,accelerationBase:new e(0,-80,0),particleTexture:c.load("spark.png"),sizeTween:new p([.5,.7,1.3],[5,40,1]),opacityTween:new p([.2,.7,2.5],[.75,1,0]),colorTween:new p([.4,.8,1],[new e(0,1,1),new e(0,1,.6),new e(.8,1,.6)]),blendStyle:U,particlesPerSecond:3e3,particleDeathAge:2.5,emitterDeathAge:.2},candle:{positionStyle:l.SPHERE,positionBase:new e(0,50,0),positionRadius:2,velocityStyle:l.CUBE,velocityBase:new e(0,100,0),velocitySpread:new e(20,0,20),particleTexture:c.load("smokeparticle.png"),sizeTween:new p([0,.3,1.2],[20,150,1]),opacityTween:new p([.9,1.5],[1,0]),colorTween:new p([.5,1],[new e(.02,1,.5),new e(.05,1,0)]),blendStyle:U,particlesPerSecond:60,particleDeathAge:1.5,emitterDeathAge:60}},m=(a,i)=>{n=new le,n.setValues(a),n.initialize(i)},u=(a,i)=>{n&&n.destroy(i),m(a,i)},A=a=>{const i=new K;i.width=100;const s={starfield:()=>u(h.starfield,a),fireflies:()=>u(h.fireflies,a),clouds:()=>u(h.clouds,a),smoke:()=>u(h.smoke,a),fireball:()=>u(h.fireball,a),candle:()=>u(h.candle,a),rain:()=>u(h.rain,a),snow:()=>u(h.snow,a),firework:()=>u(h.firework,a)};return i.add(s,"starfield").name("繁星"),i.add(s,"fireflies").name("萤火虫"),i.add(s,"clouds").name("云朵"),i.add(s,"smoke").name("烟雾"),i.add(s,"fireball").name("火球"),i.add(s,"candle").name("火焰"),i.add(s,"rain").name("下雨"),i.add(s,"snow").name("下雪"),i.add(s,"firework").name("烟花"),i.open(),()=>i.destroy()},z=()=>new q,E=a=>{const i=new N(45,a,.1,1e4);return i.position.set(0,200,400),i.lookAt(0,0,0),i},f=(a,i,s)=>{const y=new J({canvas:a,antialias:!0});return y.setSize(i,s),y.setPixelRatio(window.devicePixelRatio),y},d=(a,i)=>{const s=new Q(a,i);return s.minPolarAngle=Math.PI/4,s.maxPolarAngle=Math.PI/2*.96,s};return te(()=>{const a=o.value,i=r.value,s=i.clientWidth,y=i.clientHeight,S=z(),v=E(s/y),g=f(a,s,y),C=d(v,g.domElement),X=new $,k=()=>{const T=X.getDelta();C.update(),n&&n.update(T*.5),g.render(S,v),t=window.requestAnimationFrame(k)},V=new Z;S.add(V);const I=A(V);m(h.fireflies,V),k(),ie(()=>{I(),g.dispose(),g.forceContextLoss(),S.traverse(T=>{if(T instanceof _){const{geometry:R,material:x}=T;R&&R.dispose();const j=Array.isArray(x)?x:[x];for(const O of j)O&&O.dispose()}}),window.cancelAnimationFrame(t)})}),(a,i)=>(ae(),se("div",{ref_key:"containerElementRef",ref:r,class:"container"},[oe("canvas",{ref_key:"canvasElementRef",ref:o},null,512)],512))}},ye=ee(ce,[["__scopeId","data-v-686d379a"]]);export{ye as default};
