import{O as R,ad as S,z as B,af as M,G as h,ar as P,D as G,v as I,as as k,o as F,C as f}from"./three.module-8f39f104.js";import{O}from"./OrbitControls-8206acf3.js";import{F as N}from"./FBXLoader-0e2d8373.js";import{_ as T,r as g,o as U,a as W,b as X,c as z,d as H}from"./index-639cdcb3.js";const q={__name:"CityScene",setup(V){const p=g(null),u=g(null);let _=null;const y=()=>new S,v=e=>{const n=new B(45,e,1,1e4);return n.position.set(0,50,1e3),n.lookAt(0,0,0),n},x=(e,n,t)=>{const a=new M({canvas:e,antialias:!0});return a.setSize(n,t),a.setPixelRatio(window.devicePixelRatio),a},L=(e,n)=>{const t=new O(e,n);return t.enableDamping=!0,t.minDistance=300,t.maxDistance=6e3,t.minPolarAngle=Math.PI/4,t.maxPolarAngle=Math.PI/2*.96,t},A=()=>{const e=new h,n=new P(11382189),t=new G(16777215,.5);return t.position.set(600,600,0),e.add(n),e.add(t),e},b=e=>{new N().load("/src/assets/models/shanghai.FBX",t=>{e&&e(t)})},C={CITY_UNTRIANGULATED:(e,n)=>{const{geometry:t,position:a,material:o}=e,s=new I(new k(t,1),new F({color:"#2685fe"}));s.position.copy(a),s.rotateX(-Math.PI/2),n.add(s),o.color=new f("#0e233d"),o.transparent=!0,o.opacity=.9,n.add(e)},LANDMASS:(e,n)=>{const t=e.material;t.color=new f("#040912"),t.transparent=!0,t.opacity=.8,n.add(e)},ROADS:(e,n)=>{const t=e.material;t.color=new f("#292e4c"),n.add(e)}};return U(()=>{const e=p.value,n=u.value,t=n.clientWidth,a=n.clientHeight,o=y(),s=v(t/a),l=x(e,t,a),E=L(s,l.domElement),D=A();o.add(D),b(d=>{const r=new h;d.children.forEach(c=>{const m=c.clone(),i=C[m.name];i&&i(m,r)}),o.add(r)});const w=()=>{E.update(),l.render(o,s),_=window.requestAnimationFrame(w)};w(),W(()=>{l.dispose(),l.forceContextLoss(),o.traverse(d=>{if(d instanceof R){const{geometry:r,material:c}=d;r&&r.dispose();const m=Array.isArray(c)?c:[c];for(const i of m)i&&i.dispose()}}),window.cancelAnimationFrame(_)})}),(e,n)=>(X(),z("div",{ref_key:"containerElementRef",ref:u,class:"container"},[H("canvas",{ref_key:"canvasElementRef",ref:p},null,512)],512))}},Q=T(q,[["__scopeId","data-v-b99a0b9d"]]);export{Q as default};
