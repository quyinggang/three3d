import{O as S,ad as b,z as M,af as P,G as h,ar as B,D as G,v as I,as as k,o as O,C as f}from"./three.module-b50c6fca.js";import{O as F}from"./OrbitControls-a97fbd6e.js";import{F as N,s as T}from"./shanghai-03ff1593.js";import{_ as U,r as g,o as W,a as z,b as H,c as X,d as q}from"./index-965901d4.js";const V={__name:"CityScene",setup(Y){const p=g(null),u=g(null);let _=null;const y=()=>new b,v=e=>{const n=new M(45,e,1,1e4);return n.position.set(0,50,1e3),n.lookAt(0,0,0),n},x=(e,n,t)=>{const a=new P({canvas:e,antialias:!0});return a.setSize(n,t),a.setPixelRatio(window.devicePixelRatio),a},A=(e,n)=>{const t=new F(e,n);return t.enableDamping=!0,t.minDistance=300,t.maxDistance=6e3,t.minPolarAngle=Math.PI/4,t.maxPolarAngle=Math.PI/2*.96,t},L=()=>{const e=new h,n=new B(11382189),t=new G(16777215,.5);return t.position.set(600,600,0),e.add(n),e.add(t),e},C=e=>{new N().load(T,t=>{e&&e(t)})},E={CITY_UNTRIANGULATED:(e,n)=>{const{geometry:t,position:a,material:o}=e,s=new I(new k(t,1),new O({color:"#2685fe"}));s.position.copy(a),s.rotateX(-Math.PI/2),n.add(s),o.color=new f("#0e233d"),o.transparent=!0,o.opacity=.9,n.add(e)},LANDMASS:(e,n)=>{const t=e.material;t.color=new f("#040912"),t.transparent=!0,t.opacity=.8,n.add(e)},ROADS:(e,n)=>{const t=e.material;t.color=new f("#292e4c"),n.add(e)}};return W(()=>{const e=p.value,n=u.value,t=n.clientWidth,a=n.clientHeight,o=y(),s=v(t/a),l=x(e,t,a),D=A(s,l.domElement),R=L();o.add(R),C(d=>{const r=new h;d.children.forEach(c=>{const m=c.clone(),i=E[m.name];i&&i(m,r)}),o.add(r)});const w=()=>{D.update(),l.render(o,s),_=window.requestAnimationFrame(w)};w(),z(()=>{l.dispose(),l.forceContextLoss(),o.traverse(d=>{if(d instanceof S){const{geometry:r,material:c}=d;r&&r.dispose();const m=Array.isArray(c)?c:[c];for(const i of m)i&&i.dispose()}}),window.cancelAnimationFrame(_)})}),(e,n)=>(H(),X("div",{ref_key:"containerElementRef",ref:u,class:"container"},[q("canvas",{ref_key:"canvasElementRef",ref:p},null,512)],512))}},Z=U(V,[["__scopeId","data-v-c33a24c6"]]);export{Z as default};
