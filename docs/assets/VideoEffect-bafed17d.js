import{O as S,ad as B,z as L,af as V,b9 as A,G as I,aa as P,M as C,q as W,u as z}from"./three.module-8787a522.js";import{_ as O,r as E,o as q,a as D,b as F,c as H,d as v,u as U,p as j,e as N}from"./index-34a60af4.js";const T=""+new URL("sintel-21d505bb.mp4",import.meta.url).href;const J=p=>(j("data-v-2c60a485"),p=p(),N(),p),K=J(()=>v("span",{class:"tip"},"点击页面播放视频",-1)),Q={id:"video",loop:"",crossOrigin:"anonymous",playsinline:""},X=["src"],Y={__name:"VideoEffect",setup(p){let x=null;const w=E(null),G=E(null),R=()=>new B,b=o=>{const n=new L(45,o,1,1e3);return n.position.set(0,0,14),n.lookAt(0,0,0),n},k=(o,n,c)=>{const e=new V({canvas:o,antialias:!0});return e.setSize(n,c),e.setPixelRatio(window.devicePixelRatio),e},M=o=>{const n=new A(o),c=new I,e={width:16,height:9,xGrid:4,yGrid:3,offset:.1},u=1/e.xGrid,l=1/e.yGrid,f=e.width/e.xGrid-e.offset,i=e.height/e.yGrid-e.offset;for(let s=0;s<e.xGrid;s++)for(let d=0;d<e.yGrid;d++){const _=new P(f,i),h=new C({map:n,side:W}),a=_.attributes.uv.array;for(let r=0;r<a.length;r+=2)a[r]=(a[r]+s)*u,a[r+1]=(a[r+1]+d)*l;const t=new z(_,h);t.dx=.001*(.5-Math.random()),t.dy=.001*(.5-Math.random());const y=(s-e.xGrid/2)*f+f*.5+s*e.offset/2,m=(d-e.yGrid/2)*i+i*.5+d*e.offset/2;t.position.set(y,m,0),c.add(t)}return c};return q(()=>{const o=w.value,n=G.value,c=n.clientWidth,e=n.clientHeight,u=document.getElementById("video"),l=R(),f=b(c/e),i=k(o,c,e),s=M(u);l.add(s);const d=s.children,_=()=>{for(const t of d)t.rotation.x+=.4*t.dx,t.rotation.y+=.5*t.dy,t.position.x-=.6*t.dx,t.position.y+=.7*t.dy,t.position.z+=.8*t.dx},h=()=>{_(),i.render(l,f),x=window.requestAnimationFrame(h)};h();const a=()=>u.play();n.addEventListener("click",a),D(()=>{n.removeEventListener("click",a),i.dispose(),i.forceContextLoss(),l.traverse(t=>{if(t instanceof S){const{geometry:y,material:m}=t;y&&y.dispose();const r=Array.isArray(m)?m:[m];for(const g of r)g&&g.dispose()}}),window.cancelAnimationFrame(x)})}),(o,n)=>(F(),H("div",{ref_key:"containerElementRef",ref:G,class:"container"},[K,v("video",Q,[v("source",{src:U(T)},null,8,X)]),v("canvas",{ref_key:"canvasElementRef",ref:w},null,512)],512))}},ee=O(Y,[["__scopeId","data-v-2c60a485"]]);export{ee as default};
