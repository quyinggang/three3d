import{O as W,V as v,G as D,ah as F,M as U,u as V,ad as q,z,af as H,ai as j,aj as N,ak as X,al as Y,am as J}from"./three.module-8f39f104.js";import{O as K}from"./OrbitControls-8206acf3.js";import{E as Q,R as T,U as Z,O as $}from"./OutputPass-32cf3933.js";import{g as ee}from"./util-c747da73.js";import{_ as ne,r as A,o as te,a as se,b as oe,c as ae,d as E,p as re,e as ce}from"./index-7c705545.js";const ie=""+new URL("fearless-81b433ae.mp3",import.meta.url).href;const le=m=>(re("data-v-e020ae53"),m=m(),ce(),m),de=le(()=>E("span",{class:"tip"},"点击场景中方块播放音乐",-1)),C=64,ue={__name:"AudioScene",setup(m){const f=A(null),w=A(null);let h=null;const P=(t,e,o)=>{const s=new Q(o),n=new T(t,e),a=new Z(new v(window.innerWidth/2,window.innerHeight/2),1.5,.4,.85);return a.threshold=0,a.strength=.25,a.radius=0,s.addPass(n),s.addPass(a),s.addPass(new $),s},R=()=>{const t=new D,e=new F(1,1,1),o=C/2,s=Math.round(Math.sqrt(o));for(let n=0;n<s;n++)for(let a=0;a<s;a++){const r=ee(),i=new U({color:r}),c=new V(e,i);if(c.position.set(n-s/2,0,a-s/2),c.scale.set(.3,.3,.3),t.children.length>=o)break;t.add(c)}return t},x=()=>new q,k=t=>{const e=new z(45,t,1,1e3);return e.position.set(16,11,12),e.lookAt(0,0,0),e},L=(t,e,o)=>{const s=new H({canvas:t,antialias:!0});return s.setSize(e,o),s.setPixelRatio(window.devicePixelRatio),s},S=(t,e)=>{const o=new K(t,e);return o.minDistance=8,o.maxDistance=40,o},b=(t,e,o)=>{const s=new j,n=new v,a=r=>{n.x=r.clientX/window.innerWidth*2-1,n.y=-(r.clientY/window.innerHeight)*2+1,s.setFromCamera(n,e),s.intersectObjects(t).length>0&&o&&o()};return document.addEventListener("click",a),()=>document.removeEventListener("click",a)},B=t=>{let e=null,o=null;return new N().load(ie,function(n){const a=new X;e=new Y(a),e.setBuffer(n),e.setVolume(1),e.setLoop(!0),o=new J(e,C),t&&t(e,a,o)},()=>{},n=>{console.log(n)}),()=>{e&&e.isPlaying&&e.stop()}};return te(()=>{const t=f.value,e=w.value,o=e.clientWidth,s=e.clientHeight;let n,a;const r=x(),i=k(o/s),c=L(t,o,s),I=P(r,i,c),M=S(i,c.domElement),O=B((d,u,l)=>{n=d,a=l,i.add(u)}),G=b(r.children,i,()=>{n&&(n.isPlaying?n.pause():n.play())}),_=R();r.add(_);const y=()=>{if(M.update(),I.render(),n&&n.isPlaying&&a){const d=a.getFrequencyData();_.children.forEach((u,l)=>{const p=d[l]/45;u.scale.y=p})}h=window.requestAnimationFrame(y)};y(),se(()=>{O(),G(),c.dispose(),c.forceContextLoss(),r.traverse(d=>{if(d instanceof W){const{geometry:u,material:l}=d;u&&u.dispose();const p=Array.isArray(l)?l:[l];for(const g of p)g&&g.dispose()}}),window.cancelAnimationFrame(h)})}),(t,e)=>(oe(),ae("div",{ref_key:"containerElementRef",ref:w,class:"container"},[de,E("canvas",{ref_key:"canvasElementRef",ref:f},null,512)],512))}},_e=ne(ue,[["__scopeId","data-v-e020ae53"]]);export{_e as default};
