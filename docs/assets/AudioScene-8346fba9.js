import{O as G,V as g,G as I,ah as W,M as D,u as F,ad as V,z as q,af as z,ai as H,aj as U,ak as j,al as N,am as X}from"./three.module-8f39f104.js";import{O as Y}from"./OrbitControls-8206acf3.js";import{E as J,R as K,U as Q,O as T}from"./OutputPass-32cf3933.js";import{g as Z}from"./util-c747da73.js";import{_ as $,r as v,o as ee,a as ne,b as te,c as se,d as oe}from"./index-639cdcb3.js";const A=64,ae={__name:"AudioScene",setup(re){const f=v(null),p=v(null);let w=null;const C=(t,e,o)=>{const s=new J(o),n=new K(t,e),a=new Q(new g(window.innerWidth/2,window.innerHeight/2),1.5,.4,.85);return a.threshold=0,a.strength=.25,a.radius=0,s.addPass(n),s.addPass(a),s.addPass(new T),s},E=()=>{const t=new I,e=new W(1,1,1),o=A/2,s=Math.round(Math.sqrt(o));for(let n=0;n<s;n++)for(let a=0;a<s;a++){const r=Z(),i=new D({color:r}),c=new F(e,i);if(c.position.set(n-s/2,0,a-s/2),c.scale.set(.3,.3,.3),t.children.length>=o)break;t.add(c)}return t},P=()=>new V,x=t=>{const e=new q(45,t,1,1e3);return e.position.set(16,11,12),e.lookAt(0,0,0),e},R=(t,e,o)=>{const s=new z({canvas:t,antialias:!0});return s.setSize(e,o),s.setPixelRatio(window.devicePixelRatio),s},k=(t,e)=>{const o=new Y(t,e);return o.minDistance=8,o.maxDistance=40,o},L=(t,e,o)=>{const s=new H,n=new g,a=r=>{n.x=r.clientX/window.innerWidth*2-1,n.y=-(r.clientY/window.innerHeight)*2+1,s.setFromCamera(n,e),s.intersectObjects(t).length>0&&o&&o()};return document.addEventListener("click",a),()=>document.removeEventListener("click",a)},B=t=>{let e=null,o=null;return new U().load("src/assets/mp3/fearless.mp3",function(n){const a=new j;e=new N(a),e.setBuffer(n),e.setVolume(1),e.setLoop(!0),o=new X(e,A),t&&t(e,a,o)},()=>{},n=>{console.log(n)}),()=>{e&&e.isPlaying&&e.stop()}};return ee(()=>{const t=f.value,e=p.value,o=e.clientWidth,s=e.clientHeight;let n,a;const r=P(),i=x(o/s),c=R(t,o,s),M=C(r,i,c),b=k(i,c.domElement),O=B((d,u,l)=>{n=d,a=l,i.add(u)}),S=L(r.children,i,()=>{n&&(n.isPlaying?n.pause():n.play())}),h=E();r.add(h);const y=()=>{if(b.update(),M.render(),n&&n.isPlaying&&a){const d=a.getFrequencyData();h.children.forEach((u,l)=>{const m=d[l]/45;u.scale.y=m})}w=window.requestAnimationFrame(y)};y(),ne(()=>{O(),S(),c.dispose(),c.forceContextLoss(),r.traverse(d=>{if(d instanceof G){const{geometry:u,material:l}=d;u&&u.dispose();const m=Array.isArray(l)?l:[l];for(const _ of m)_&&_.dispose()}}),window.cancelAnimationFrame(w)})}),(t,e)=>(te(),se("div",{ref_key:"containerElementRef",ref:p,class:"container"},[oe("canvas",{ref_key:"canvasElementRef",ref:f},null,512)],512))}},me=$(ae,[["__scopeId","data-v-d73349c2"]]);export{me as default};
