import{af as T,aG as $,ad as F,E as O,a$ as N,aA as Q,aP as X,aQ as Y,V as j,z as k,ah as J,u as K,M as Z,C as z}from"./three.module-b483cf05.js";import{O as f}from"./OrbitControls-3e78db25.js";import{g as ee}from"./util-863f647e.js";import{_ as te,r as b,o as ne,w as oe,a as ae,b as se,c as ie,d as y,t as ce,p as re,e as de}from"./index-964def9b.js";const le=x=>(re("data-v-731ea8f5"),x=x(),de(),x),pe=le(()=>y("span",null,"切换方案：",-1)),me={__name:"PreviewScene",setup(x){const A=b(null),B=b(null),g=b(1);let m=null;const _=()=>{const o=window.devicePixelRatio,t={width:70,height:70},e=document.createElement("canvas");e.id="preview",e.width=t.width,e.height=t.height;const n="position:absolute;right:10px;bottom:10px;z-index:1;";return e.style.cssText=`${n}border:1px solid #fff;width:${t.width*o}px;height:${t.height*o}px;`,e},W=(o,t,e)=>{const n=new T({canvas:o,antialias:!0});return n.setSize(t,e),n.setPixelRatio(window.devicePixelRatio),n},v=(o,t)=>{const e=new F,n=new k(45,o/t,1,1e3);n.position.set(1,1,6),n.lookAt(e.position);const a=new J(1,1,1),i=new K(a,new Z({color:ee()}));return e.add(i),{scene:e,camera:n}},M=(o,t,e,n)=>{const{scene:a,camera:i}=v(o,t),c=n.getContext("2d"),s=n.width,r=n.height,d=()=>{const h=new Image,u=l.toDataURL();h.onload=()=>{c.drawImage(h,0,0,s,r)},h.src=u},l=e.domElement,p=new f(i,l),w=()=>{p.update(),e.render(a,i),d(),m=window.requestAnimationFrame(w)};w()},q=(o,t,e,n)=>{const{scene:a,camera:i}=v(o,t),c=window.devicePixelRatio,s={width:o*c,height:t*c},r=new $(s.width,s.height,{depthBuffer:!1}),d=n.width,l=n.height,p=n.getContext("2d"),w=()=>{const R=new Uint8Array(s.width*s.height*4),S=new Uint8ClampedArray(R.buffer);e.readRenderTargetPixels(r,0,0,s.width,s.height,S);const P=new ImageData(S,s.width,s.height);createImageBitmap(P).then(C=>{p.drawImage(C,0,0,d,l)})},h=new f(i,e.domElement),u=()=>{h.update(),e.setRenderTarget(r),e.render(a,i),w(),e.setRenderTarget(null),e.render(a,i),m=window.requestAnimationFrame(u)};u()},H=(o,t,e)=>{const{scene:n,camera:a}=v(o,t);a.position.z=20;const i=window.devicePixelRatio,c=80*i,s=new F,r=new O(-o/2,o/2,t/2,-t/2,1,10);r.position.z=10,r.lookAt(s.position);const d=new N(c,c,Q),l=new X({map:d}),p=new Y(l),w=10,h=o/2,u=t/2,R=c/2,S=c/2,P=h-R,C=-u+S;p.position.set(P-w,C+w,1),p.scale.set(c,c,1),s.add(p);const I=new j;I.set(o*i/2-c/2,t*i/2-c/2);const U=new f(a,e.domElement);e.autoClear=!1;const E=()=>{U.update(),e.clear(),e.render(n,a),e.copyFramebufferToTexture(I,d),e.clearDepth(),e.render(s,r),m=window.requestAnimationFrame(E)};E()},V=(o,t,e)=>{const{scene:n,camera:a}=v(o,t),c=70*window.devicePixelRatio,s=new k(45,o/t,1,1e3);s.position.set(1,1,6),s.lookAt(n.position);const r={x:0,y:0,width:o,height:t},d={x:o-c-4,y:4,width:c,height:c},l=new f(a,e.domElement),p=()=>{l.update(),e.setScissorTest(!0),n.background=new z("#000"),e.setScissor(r.x,r.y,r.width,r.height),e.setViewport(r.x,r.y,r.width,r.height),e.render(n,a),n.background=new z(2236962),e.setScissor(d.x,d.y,d.width,d.height),e.setViewport(d.x,d.y,d.width,d.height),s.position.copy(a.position),s.quaternion.copy(a.quaternion),e.render(n,s),e.setScissorTest(!1),m=window.requestAnimationFrame(p)};p()},D=(o,t,e,n)=>{const{scene:a,camera:i}=v(o,t),c=n.clientWidth,s=n.clientHeight,r=new T({canvas:n,antialias:!0});r.setSize(c,s),r.setPixelRatio(window.devicePixelRatio);const d=new f(i,e.domElement),l=()=>{d.update(),r.render(a,i),e.render(a,i),m=window.requestAnimationFrame(l)};l()},G=()=>{g.value=g.value>=5?1:g.value+1},L={5:(o,t,e,n)=>{const a=_();n.appendChild(a),M(o,t,e,a)},4:(o,t,e,n)=>{const a=_();n.appendChild(a),q(o,t,e,a)},3:(o,t,e)=>{H(o,t,e)},2:(o,t,e)=>{V(o,t,e)},1:(o,t,e,n)=>{const a=_();n.appendChild(a),D(o,t,e,a)}};return ne(()=>{const o=A.value,t=B.value,e=t.clientWidth,n=t.clientHeight,a=()=>{const i=document.getElementById("preview");i&&t.removeChild(i),m&&window.cancelAnimationFrame(m)};oe(g,i=>{a();const c=L[i];if(c){const s=W(o,e,n);c(e,n,s,t)}},{immediate:!0})}),ae(()=>window.cancelAnimationFrame(m)),(o,t)=>(se(),ie("div",{ref_key:"containerElementRef",ref:B,class:"container"},[y("div",{class:"button",onClick:G},[pe,y("span",null,"方案"+ce(g.value),1)]),y("canvas",{ref_key:"canvasElementRef",ref:A},null,512)],512))}},ve=te(me,[["__scopeId","data-v-731ea8f5"]]);export{ve as default};
