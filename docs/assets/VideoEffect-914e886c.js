import{O as S,ad as B,z as L,af as V,ba as A,G as C,aa as I,M as P,q as W,u as z,ag as O}from"./three.module-b50c6fca.js";import{_ as T,r as E,o as q,a as D,b as F,c as H,d as v,u as U,p as j,e as N}from"./index-965901d4.js";const J=""+new URL("sintel-21d505bb.mp4",import.meta.url).href;const K=u=>(j("data-v-11e73ebe"),u=u(),N(),u),Q=K(()=>v("span",{class:"tip"},"点击页面播放视频",-1)),X={id:"video",loop:"",crossOrigin:"anonymous",playsinline:""},Y=["src"],Z={__name:"VideoEffect",setup(u){let x=null;const w=E(null),g=E(null),M=()=>new B,b=s=>{const n=new L(45,s,1,1e3);return n.position.set(0,0,14),n.lookAt(0,0,0),n},k=(s,n,i)=>{const e=new V({canvas:s,antialias:!0});return e.setSize(n,i),e.setPixelRatio(window.devicePixelRatio),e},R=s=>{const n=new A(s),i=new C,e={width:16,height:9,xGrid:4,yGrid:3,offset:.1},h=1/e.xGrid,f=1/e.yGrid,m=e.width/e.xGrid-e.offset,d=e.height/e.yGrid-e.offset;for(let a=0;a<e.xGrid;a++)for(let l=0;l<e.yGrid;l++){const _=new I(m,d),y=new P({map:n,side:W}),c=_.attributes.uv.array;for(let r=0;r<c.length;r+=2)c[r]=(c[r]+a)*h,c[r+1]=(c[r+1]+l)*f;const o=new z(_,y);o.dx=.004*(.5-Math.random()),o.dy=.004*(.5-Math.random());const t=(a-e.xGrid/2)*m+m*.5+a*e.offset/2,p=(l-e.yGrid/2)*d+d*.5+l*e.offset/2;o.position.set(t,p,0),i.add(o)}return i};return q(()=>{const s=w.value,n=g.value,i=n.clientWidth,e=n.clientHeight,h=document.getElementById("video"),f=M(),m=b(i/e),d=k(s,i,e),a=R(h);f.add(a);const l=new O,_=a.children,y=()=>{const o=l.getElapsedTime();for(const t of _)t.rotation.x+=Math.sin(o*.1)*t.dx,t.rotation.y+=Math.sin(o*.2)*t.dy,t.position.x-=Math.sin(o*.1)*t.dx,t.position.y+=Math.sin(o*.3)*t.dy,t.position.z+=Math.cos(o*.2)*t.dx;d.render(f,m),x=window.requestAnimationFrame(y)};y();const c=()=>h.play();n.addEventListener("click",c),D(()=>{n.removeEventListener("click",c),d.dispose(),d.forceContextLoss(),f.traverse(o=>{if(o instanceof S){const{geometry:t,material:p}=o;t&&t.dispose();const r=Array.isArray(p)?p:[p];for(const G of r)G&&G.dispose()}}),window.cancelAnimationFrame(x)})}),(s,n)=>(F(),H("div",{ref_key:"containerElementRef",ref:g,class:"container"},[Q,v("video",X,[v("source",{src:U(J)},null,8,Y)]),v("canvas",{ref_key:"canvasElementRef",ref:w},null,512)],512))}},te=T(Z,[["__scopeId","data-v-11e73ebe"]]);export{te as default};
